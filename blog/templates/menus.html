{% extends "base.html"%}
{% load static %}
{% block contenido %}


  <div class="menu-compras">
    {% for menu in menus %}
    {% if user.username == 'admin' %}
    <div class="food-items">
      <img src="{{ menu.imagen.url }}"/>
      <div class="detalles">
        <div class="detalles-categoria">
          <h5>{{ menu.nombre_menu }}</h5>
          <h5 class = "precio">{{ menu.precio }}</h5>
        </div>
        <p>{{ menu.descripcion_menu}}</p>
          <button class="btn btn-primary btn-edit">Editar</button>
            <div class="form-check">
              <input 
                type="checkbox" 
                class="form-check-input menu-status-toggle" 
                data-menu-id="{{ menu.id }}" 
                {% if menu.estado_menu %} checked {% endif %}>
              <label class="form-check-label">Estado del Menú</label>
            </div>
      </div>
    </div>
    {% else %}
    <div class="food-items">
      <img src="{{ menu.imagen.url }}"/>
      <div class="detalles">
        <div class="detalles-categoria">
          <h5>{{ menu.nombre_menu }}</h5>
          <h5 class = "precio">Precio: ${{ menu.precio }}</h5>
        </div>
        <p>{{ menu.descripcion_menu}}</p>
        <button class="btn btn-success">Agregar al carrito</button>
      </div>
    </div>
    {% endif %}
    {% endfor %}
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const menuStatusToggles = document.querySelectorAll('.menu-status-toggle');
  
      menuStatusToggles.forEach(toggle => {
        toggle.addEventListener('change', async (event) => {
          const menu_id = event.target.dataset.menu_id;
          const isChecked = event.target.checked;
  
          try {
            const response = await fetch(`/api/menus/menu/${menu_id}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                estado_menu: isChecked
              })
            });
  
            if (response.ok) {
              console.log(`Estado del menú con ID ${menu_id} actualizado`);
            } else {
              console.error(`Error al actualizar el estado del menú ${menu_id}`);
              // Vuelve a cambiar el estado del checkbox si hay un error
              event.target.checked = !isChecked;
            }
          } catch (error) {
            console.error('Error en la solicitud:', error);
            // Vuelve a cambiar el estado del checkbox si hay un error
            event.target.checked = !isChecked;
          }
        });
      });
    });
  </script>



{%endblock%}